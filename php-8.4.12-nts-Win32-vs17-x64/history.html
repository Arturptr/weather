<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>KazP • История</title>
	<link rel="stylesheet" href="assets/style.css"/>
</head>
<body>
	<header class="kp-header">
		<div class="kp-container">
			<div class="kp-brand">KazP<span>Team</span></div>
			<nav class="kp-nav">
				<a href="index.php">Главная</a>
				<a class="active" href="#">История</a>
				<a href="bookmarks.html">Закладки</a>
				<a href="login.html" id="navLogin">Вход</a>
				<a href="register.html" id="navRegister">Регистрация</a>
				<a href="#" id="navLogout" style="display:none;" onclick="window.kpLogout&&window.kpLogout();return false;">Выйти</a>
			</nav>
		</div>
	</header>
	<main class="kp-container">
		<section class="kp-card">
			<h2>История запросов</h2>
			<div id="histList" class="kp-list" style="grid-template-columns:1fr;"></div>
			<div id="status" class="kp-status" aria-live="polite"></div>
		</section>
	</main>
	<script>
	(function(){
		var list = document.getElementById('histList');
		var statusEl = document.getElementById('status');
		function setStatus(m,e){ statusEl.textContent=m||''; statusEl.style.color=e?'#fda4af':'#94a3b8'; }
		function load(){
			var token = localStorage.getItem('kp_token');
			if (!token) { setStatus('Нужен вход', true); return; }
			setStatus('Загрузка…');
			fetch('api.php?route=/api/history', { headers: { 'Authorization': 'Bearer ' + token }})
				.then(function(r){ return r.json(); })
				.then(function(res){
					list.innerHTML='';
					(res.items||[]).forEach(function(h){
						var div=document.createElement('div'); div.className='kp-item';
						var p = JSON.parse(h.params_json||'{}');
						div.innerHTML='<div><strong>'+h.endpoint+'</strong></div>'+
							'<div class="meta">'+h.created_at+'</div>'+
							'<pre style="white-space:pre-wrap;font-size:12px;color:#cbd5e1;background:#0b1020;border-radius:8px;padding:8px;border:1px solid var(--kp-border);">'+JSON.stringify(p,null,2)+'</pre>';
						list.appendChild(div);
					});
					setStatus('');
				})
				.catch(function(){ setStatus('Ошибка загрузки', true); });
		}
		load();
	})();
	</script>
	<script src="assets/user.js"></script>
</body>
</html>


