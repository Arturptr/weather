<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Weather & Relax ‚Äî –ü–æ–≥–æ–¥–∞ –∏ –æ—Ç–¥—ã—Ö</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script defer src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
:root {
  --bg-page: linear-gradient(180deg,#f4f7fb 0%,#eef5fb 100%);
  --card: rgba(255,255,255,0.9);
  --accent: #4f46e5;
  --muted: #6b7280;
  --radius: 14px;
  --font: 'Inter', sans-serif;
}
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; font-family: var(--font); background: var(--bg-page); color: #0f172a; }
.topbar {
  position: sticky; top: 0; z-index: 1200; display: flex; align-items: center; justify-content: center;
  gap: 28px; padding: 14px 20px; backdrop-filter: blur(6px);
  background: linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.55));
  border-bottom: 1px solid rgba(15,23,42,0.06);
}
.topbar a {
  text-decoration: none; color: var(--muted); font-weight: 600; padding: 8px 12px; border-radius: 10px;
  transition: all .22s; letter-spacing: .2px;
}
.topbar a:hover { color:white; background: linear-gradient(90deg,var(--accent), #06b6d4); transform: translateY(-3px); }
.wrap { max-width: 1200px; margin: 26px auto; padding: 0 20px 60px; }
.grid { display: grid; grid-template-columns: 1fr 420px; gap: 22px; align-items: start; }
.map-card, .card { background: var(--card); border-radius: var(--radius); padding: 16px;
  box-shadow: 0 10px 30px rgba(12,18,39,0.06); border: 1px solid rgba(15,23,42,0.04); }
#map { width: 100%; height: 66vh; min-height: 420px; border-radius: 12px; }
.field input[type="text"], .field input[type="number"] {
  width: 100%; padding: 12px 14px; border-radius: 10px; border: 1px solid rgba(12,18,39,0.08);
  background: rgba(255,255,255,0.9); font-size: 14px; outline: none;
}
input:focus { border-color: rgba(79,70,229,0.5); box-shadow: 0 6px 18px rgba(79,70,229,0.12); }
.btn {
  display: inline-flex; align-items: center; justify-content: center; padding: 11px 14px; border-radius: 10px;
  cursor: pointer; border: none; font-weight: 700; font-size: 14px; transition: transform .12s, box-shadow .12s;
}
.btn-primary { background: linear-gradient(90deg,var(--accent), #06b6d4); color:#fff; }
.btn-secondary { background: rgba(79,70,229,0.15); color: var(--accent); }
.btn-primary:hover { transform: translateY(-3px); box-shadow: 0 18px 40px rgba(79,70,229,0.18); }
.btn-secondary:hover { background: rgba(79,70,229,0.25); transform: translateY(-3px); }
.month-row { display:flex; gap:4px; overflow-x:auto; padding:6px 0; scroll-behavior:smooth; }
.month-row span {
  flex:0 0 auto; width:60px; text-align:center; padding:12px 0 4px; border-radius:8px; cursor:pointer;
  transition: all 0.2s; white-space: pre-line; margin-top: 40px;
}
.month-row span:hover { background: var(--accent); color:white; }
.month-row span.selected { background: linear-gradient(90deg,var(--accent), #06b6d4); color:white; font-weight:700; }
@media(max-width:980px){.grid{grid-template-columns:1fr;}}

/* –°—Ç–∏–ª–∏ –¥–ª—è Relax */
.relax .grid { grid-template-columns: repeat(auto-fit, minmax(280px,1fr)); gap:20px; }
.relax .card { transition: transform .2s; }
.relax .card:hover { transform: translateY(-4px); }
.relax .btn { display:inline-block; padding:10px 14px; border-radius:10px; background: linear-gradient(90deg,#4f46e5,#06b6d4); color:#fff; text-decoration:none; font-weight:600; margin-top:10px; }
.relax .weather { font-size:14px; color:#555; margin-top:6px; }
</style>
</head>
<body>

<nav class="topbar">
  <a href="#" onclick="showSection('main')">–ì–ª–∞–≤–Ω–∞—è</a>
  <a href="#" onclick="showSection('cataclysms')">–ö–∞—Ç–∞–∫–ª–∏–∑–º—ã</a>
  <a href="#" onclick="showSection('facts')">–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã</a>
  <a href="#" onclick="showSection('relax')">–ú–µ—Å—Ç–∞ –æ—Ç–¥—ã—Ö–∞</a>
</nav>

<!-- –ì–ª–∞–≤–Ω–∞—è -->
<main class="wrap section" id="main">
  <div class="grid">
    <div class="map-card">
      <div class="map-head">
        <div>
          <div class="map-title" style="font-weight:700;font-size:18px;">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞</div>
          <div class="map-sub" style="font-size:13px;color:var(--muted);">–ö–ª–∏–∫–Ω–∏ –ø–æ –∫–∞—Ä—Ç–µ –∏–ª–∏ –≤–≤–µ–¥–∏ –ª–æ–∫–∞—Ü–∏—é</div>
        </div>
      </div>
      <div id="map"></div>
    </div>

    <aside class="panel">
      <div class="card">
        <h3>–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑</h3>
        <div class="field"><label>–õ–æ–∫–∞—Ü–∏—è</label><input id="inputLocation" type="text" placeholder="–ì–æ—Ä–æ–¥ –∏–ª–∏ –∞–¥—Ä–µ—Å" /></div>
        <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:14px;">
          <button id="btnForecast" class="btn btn-primary">–ü—Ä–æ–≥–Ω–æ–∑</button>
          <button id="btnUseMap" class="btn btn-secondary">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É</button>
          <button id="btnClear" class="btn btn-secondary">–û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑</button>
          <button id="btnHistory" class="btn btn-secondary">–ò—Å—Ç–æ—Ä–∏—è</button>
          <button id="btnFavorites" class="btn btn-secondary">–ò–∑–±—Ä–∞–Ω–Ω—ã–µ</button>
        </div>
      </div>

      <div class="card">
        <h4>–í—ã–±–µ—Ä–∏ –¥–∞—Ç—É</h4>
        <div class="field">
          <label>–î–µ–Ω—å</label>
          <input id="dayInput" type="text" inputmode="numeric" placeholder="–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 31" maxlength="2" />
        </div>
        <div class="month-row" id="monthRow"></div>
        <p id="selectedDate" style="text-align:center;margin-top:12px;font-weight:600;font-size:16px;">–í—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞: ‚Äî</p>
      </div>
    </aside>
  </div>
</main>
<section class="wrap section" id="cataclysms" style="display:none;">
  <h1 style="text-align:center;">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–∞—Ç–∞–∫–ª–∏–∑–º–æ–≤</h1>
  <h3 id="catLocation" style="text-align:center;color:var(--muted);"></h3>
  <div class="grid" id="catGrid"></div>
  <div style="text-align:center;margin-top:20px;">
    <button class="btn btn-primary" onclick="generateCataclysms()">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑</button>
  </div>
</section>

<!-- –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã -->
<section class="wrap section" id="facts" style="display:none;">
  <h1 style="text-align:center;">–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã –æ –ø–æ–≥–æ–¥–µ</h1>
  <div id="factList" style="display:flex;flex-direction:column;gap:14px;"></div>
  <div style="text-align:center;margin-top:20px;">
    <button class="btn btn-primary" onclick="generateFacts()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ñ–∞–∫—Ç—ã</button>
  </div>
</section>

<!-- –ú–µ—Å—Ç–∞ –æ—Ç–¥—ã—Ö–∞ -->
<section class="wrap section relax" id="relax" style="display:none;">
  <h1 style="text-align:center;">üå¥ –õ—É—á—à–∏–µ –º–µ—Å—Ç–∞ –¥–ª—è –æ—Ç–¥—ã—Ö–∞</h1>
  <div class="grid">
    <div class="card">
      <h3>–ú–∞–ª—å–¥–∏–≤—ã</h3>
      <p>üåä –ë–µ–ª–æ—Å–Ω–µ–∂–Ω—ã–µ –ø–ª—è–∂–∏, –∫–æ—Ä–∞–ª–ª—ã –∏ –ª–∞–∑—É—Ä–Ω–∞—è –≤–æ–¥–∞.</p>
      <div class="weather">‚òÄ +31¬∞C, –ª—ë–≥–∫–∏–π –±—Ä–∏–∑</div>
      <a class="btn" href="https://www.tui.ru/" target="_blank">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ç—É—Ä</a>
    </div>
    <div class="card">
      <h3>–¢—É—Ä—Ü–∏—è</h3>
      <p>üèñ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫—É—Ä–æ—Ä—Ç—ã –ê–Ω—Ç–∞–ª–∏–∏ –∏ –ê–ª–∞–Ω–∏–∏ –∂–¥—É—Ç —Ç–µ–±—è!</p>
      <div class="weather">‚òÄ +28¬∞C, —Å–æ–ª–Ω—Ü–µ –≤–µ—Å—å –¥–µ–Ω—å</div>
      <a class="btn" href="https://tez-tour.com/" target="_blank">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ä—ã</a>
    </div>
    <div class="card">
      <h3>–¢–∞–∏–ª–∞–Ω–¥</h3>
      <p>üêò –≠–∫–∑–æ—Ç–∏–∫–∞, –≤–∫—É—Å–Ω–∞—è –µ–¥–∞ –∏ —Ö—Ä–∞–º–æ–≤—ã–µ –≥–æ—Ä—ã.</p>
      <div class="weather">üå¶ +30¬∞C, –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ–∂–¥–∏</div>
      <a class="btn" href="https://coral.ru/" target="_blank">–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</a>
    </div>
    <div class="card">
      <h3>–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω ‚Äî –ë–æ—Ä–æ–≤–æ–µ</h3>
      <p>üå≤ –û–∑—ë—Ä–∞, –≥–æ—Ä—ã –∏ —Å–≤–µ–∂–∏–π –≤–æ–∑–¥—É—Ö ‚Äî –≤—Å—ë —Ä—è–¥–æ–º!</p>
      <div class="weather">üå§ +22¬∞C, –ª—ë–≥–∫–∏–π –≤–µ—Ç–µ—Ä</div>
      <a class="btn" href="https://kaztour.kz/" target="_blank">–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ</a>
    </div>
    <div class="card">
      <h3>–û–ê–≠ ‚Äî –î—É–±–∞–π</h3>
      <p>üèô –†–æ—Å–∫–æ—à–Ω—ã–µ –æ—Ç–µ–ª–∏, –Ω–µ–±–æ—Å–∫—Ä—ë–±—ã –∏ –∑–æ–ª–æ—Ç—ã–µ –ø–ª—è–∂–∏.</p>
      <div class="weather">‚òÄ +36¬∞C, –∂–∞—Ä–∫–æ –∏ —Å–æ–ª–Ω–µ—á–Ω–æ</div>
      <a class="btn" href="https://anextour.com/" target="_blank">–°–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ä—ã</a>
    </div>
  </div>
</section>

<script>
// JS-–∫–æ–¥ –¥–ª—è –∫–∞—Ä—Ç—ã, –ø—Ä–æ–≥–Ω–æ–∑–∞, —Ñ–∞–∫—Ç–æ–≤, –∫–∞—Ç–∞–∫–ª–∏–∑–º–æ–≤ –∏ –¥–∞—Ç
let map, previewMarker=null, selectedMarker=null;
let lastLocation = {name: null, lat: null, lon: null};
let history = JSON.parse(localStorage.getItem("forecastHistory")||"[]");
let favorites = JSON.parse(localStorage.getItem("favorites")||"[]");

function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
  if(id==='cataclysms') generateCataclysms();
  if(id==='facts') generateFacts();
}

function initMap() {
  map=L.map('map').setView([48,68],5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
  map.on('click', e=>{
    const {lat, lng: lon} = e.latlng;
    if(previewMarker) previewMarker.setLatLng([lat,lon]);
    else previewMarker=L.circleMarker([lat,lon],{radius:10, fillColor:'#4f46e5', color:'#fff', weight:2, fillOpacity:0.6}).addTo(map);
  });
}

function placeSelected(lat, lon, content){
  if(selectedMarker) selectedMarker.remove();
  selectedMarker=L.marker([lat,lon]).addTo(map);
  if(content) selectedMarker.bindPopup(content).openPopup();
  map.setView([lat,lon],11);
}

function generateForecast(){
  const temp=(Math.random()*50-15).toFixed(1);
  const hum=Math.floor(Math.random()*90+10);
  const precip=Math.random()<0.5?+(Math.random()*5).toFixed(1):0;
  return {temp, hum, precip, cond: precip>0?"–î–æ–∂–¥—å":"–Ø—Å–Ω–æ"};
}

document.addEventListener('DOMContentLoaded', ()=>{
  initMap();
  const inputLocation = document.getElementById('inputLocation');
  const btnForecast = document.getElementById('btnForecast');
  const btnUseMap = document.getElementById('btnUseMap');
  const btnClear = document.getElementById('btnClear');
  const btnHistory = document.getElementById('btnHistory');
  const btnFavorites = document.getElementById('btnFavorites');
  const monthRow = document.getElementById('monthRow');
  const selectedDateEl = document.getElementById('selectedDate');
  const dayInput = document.getElementById('dayInput');
  const months = ["01","02","03","04","05","06","07","08","09","10","11","12"];
  const startYear=1980,endYear=2040;
  const defaultMonth = "10";
const defaultYear = "2025";
const defaultDay = "5"; // –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å defaultDay

function createMonthRow() {
  // –°–æ–∑–¥–∞—ë–º –º–µ—Å—è—Ü—ã –∏ –≥–æ–¥—ã
  for (let y = startYear; y <= endYear; y++) {
    months.forEach(m => {
      const span = document.createElement("span");
      span.textContent = `${m}\n${y}`;
      span.dataset.year = y;
      span.dataset.month = m;
      span.style.whiteSpace = "pre-line";

      span.onclick = () => {
        document.querySelectorAll(".month-row span").forEach(el => el.classList.remove("selected"));
        span.classList.add("selected");

        const d = dayInput.value || "--";
        selectedDateEl.textContent = `–í—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞: ${d}.${m}.${y}`;

        // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –Ω–∞ —à–∫–∞–ª–µ
        span.scrollIntoView({ behavior: "smooth", inline: "center" });
      };

      monthRow.appendChild(span);
    });
  }

  // üü£ –î–µ—Ñ–æ–ª—Ç: –Ω–æ—è–±—Ä—å 2025
  const defaultMonth = "10";
  const defaultYear = "2025";

  // –ü–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ ‚Äî –≤—ã–±–∏—Ä–∞–µ–º –Ω—É–∂–Ω—ã–π –º–µ—Å—è—Ü
  requestAnimationFrame(() => {
    const defaultSpan = [...monthRow.querySelectorAll("span")].find(
      el => el.dataset.month === defaultMonth && el.dataset.year === defaultYear
    );

    if (defaultSpan) {
      defaultSpan.classList.add("selected");
      const defaultDay = "5"; // –ø–æ –∂–µ–ª–∞–Ω–∏—é
      dayInput.value = defaultDay;
      selectedDateEl.textContent = `–í—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞: ${defaultDay}.${defaultMonth}.${defaultYear}`;
      // ‚¨áÔ∏è –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –º–µ—Å—è—Ü
      defaultSpan.scrollIntoView({ behavior: "auto", inline: "center" });
    }
  });
}

  createMonthRow();
  // ---- üóì –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –Ω–æ—è–±—Ä—å 2025 ----
// ---- üóì –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –Ω–æ—è–±—Ä—å 2025 ----

const defaultSpan = [...monthRow.querySelectorAll("span")].find(
  el => el.dataset.month === defaultMonth && el.dataset.year === defaultYear
);

if (defaultSpan) {
  // –≤—ã–¥–µ–ª—è–µ–º –º–µ—Å—è—Ü
  defaultSpan.classList.add("selected");

  // –∑–∞–¥–∞—ë–º —Ç–µ–∫—Å—Ç –¥–∞—Ç—ã
  dayInput.value = defaultDay;
  selectedDateEl.textContent = `–í—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞: ${defaultDay}.${defaultMonth}.${defaultYear}`;

  // –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º ‚Äî —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏
  const targetScroll = defaultSpan.offsetLeft - monthRow.clientWidth / 3;
  monthRow.scrollTo({
    left: Math.max(0, targetScroll),
    behavior: "smooth"
  });
}


btnForecast.onclick = async () => {
  let city = inputLocation.value.trim();
  const day = dayInput.value;
  const selected = document.querySelector(".month-row span.selected");
  const month = selected ? selected.dataset.month : "";
  const year = selected ? selected.dataset.year : "";

  if (!city || !day || !month || !year) {
    alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É (–¥–µ–Ω—å, –º–µ—Å—è—Ü, –≥–æ–¥).");
    return;
  }

  city = city.toLowerCase();

  try {
    const response = await fetch("get_forecast.php", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({ city, day, month, year }),
    });

    const result = await response.json();

    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –º–µ—Ç–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
    if (window.weatherMarker) {
      map.removeLayer(window.weatherMarker);
    }

    if (result.exists === 1) {
      const temp = result.data.temp;
      const wind = result.data.wind;
      const prec_prob = result.data.prec_prob;

      // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫–∞ (–º–æ–∂–Ω–æ –ø–æ—Ç–æ–º —Å–¥–µ–ª–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
      const lat = 54.87;
      const lon = 69.15;

      // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä —Å popup
      window.weatherMarker = L.marker([lat, lon])
        .addTo(map)
        .bindPopup(
          `<b>–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫</b><br>
           –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${temp}¬∞C<br>
           –°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞: ${wind}<br>
           –í—ã—Å–æ—Ç–∞ –æ—Å–∞–¥–∫–æ–≤: ${prec_prob}`
        )
        .openPopup();

      // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
      map.setView([lat, lon], 8);

      // === –ù–æ–≤—ã–π –±–ª–æ–∫ –∏–∑ –¥—Ä—É–≥–æ–≥–æ –∫–æ–¥–∞ ===
      // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –ø–∞–Ω–µ–ª–∏
      document.getElementById('result').innerHTML = `
        <p>üå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${temp}¬∞C</p>
        <p>üí® –í–µ—Ç–µ—Ä: ${wind}</p>
        <p>‚òî –û—Å–∞–¥–∫–∏: ${prec_prob}</p>
      `;

      // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–¥ –∫–∞—Ä—Ç–æ–π
      renderActivities(temp);

      // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è
      const eventType = document.getElementById('eventType')?.value;
      if(eventType) {
        const locationName = city.charAt(0).toUpperCase() + city.slice(1);
        openAlternativesModal_inner(eventType, locationName);
      }
      // === –ö–æ–Ω–µ—Ü –Ω–æ–≤–æ–≥–æ –±–ª–æ–∫–∞ ===

    } else {
      // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî —É–¥–∞–ª—è–µ–º –º–µ—Ç–∫—É
      if (window.weatherMarker) {
        map.removeLayer(window.weatherMarker);
      }
      alert(`‚ùå –í –±–∞–∑–µ –Ω–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑–∞ –¥–ª—è ${city} ${day}.${month}.${year}.`);
    }
  } catch (err) {
    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ:", err);
  }
};









  btnUseMap.onclick = ()=>alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ –∏ –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–æ–≥–Ω–æ–∑!");
  btnClear.onclick = ()=>{
    if(selectedMarker){ map.removeLayer(selectedMarker); selectedMarker=null; }
    alert("–ü—Ä–æ–≥–Ω–æ–∑ –æ—á–∏—â–µ–Ω.");
  };
  btnHistory.onclick = ()=>{
    if(!history.length) return alert("–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞!");
    alert("–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤:\n\n"+history.map(h=>`${h.loc} (${h.day}.${h.m}.${h.y}) ‚Äî ${h.forecast.temp}¬∞C`).join("\n"));
  };
  btnFavorites.onclick = ()=>{
    if(lastLocation.name){
      favorites.push(lastLocation);
      localStorage.setItem("favorites", JSON.stringify(favorites));
      alert("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!");
    } else alert("–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏ –ø—Ä–æ–≥–Ω–æ–∑, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ.");
  };
});

function pseudoRandom(lat, lon, i){
  const seed = Math.sin(lat*1000 + lon*1000 + i*9999) * 10000;
  return seed - Math.floor(seed);
}

function generateCataclysms(){
  const grid=document.getElementById('catGrid');
  const locTitle=document.getElementById('catLocation');
  grid.innerHTML='';
  if(!lastLocation.lat){
    locTitle.textContent="‚ùó –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ –ª–æ–∫–∞—Ü–∏—é –∏ –ø–æ–ª—É—á–∏ –ø—Ä–æ–≥–Ω–æ–∑!";
    return;
  }
  locTitle.textContent = `–õ–æ–∫–∞—Ü–∏—è: ${lastLocation.name} (${lastLocation.lat.toFixed(2)}, ${lastLocation.lon.toFixed(2)})`;
  const events=['–°–∏–ª—å–Ω—ã–π —à—Ç–æ—Ä–º','–ù–∞–≤–æ–¥–Ω–µ–Ω–∏–µ','–ó–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–µ','–¢–æ—Ä–Ω–∞–¥–æ','–õ–∞–≤–∏–Ω–∞','–¶—É–Ω–∞–º–∏','–ü–µ—Å—á–∞–Ω–∞—è –±—É—Ä—è'];
  events.forEach((e,i)=>{
    const base = pseudoRandom(lastLocation.lat,lastLocation.lon,i);
        const prob = (base*100).toFixed(1); // –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–∞—Ç–∞–∫–ª–∏–∑–º–∞ –≤ %
    grid.innerHTML += `<div class='card'><h3>${e}</h3><p>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: <b>${prob}%</b></p></div>`;
  });
}

function generateFacts(){
  const facts=[
    '–°–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –≤ 1913 –≥–æ–¥—É –≤ –î–æ–ª–∏–Ω–µ –°–º–µ—Ä—Ç–∏ ‚Äî +56.7¬∞C.',
    '–í –ê–Ω—Ç–∞—Ä–∫—Ç–∏–¥–µ –≤–æ–∑–º–æ–∂–Ω—ã —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –Ω–∏–∂–µ ‚àí90¬∞C.',
    '–ú–æ–ª–Ω–∏—è –Ω–∞–≥—Ä–µ–≤–∞–µ—Ç –≤–æ–∑–¥—É—Ö –¥–æ 30 000¬∞C ‚Äî –≥–æ—Ä—è—á–µ–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –°–æ–ª–Ω—Ü–∞!',
    '–ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –Ω–∞ –ó–µ–º–ª–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–∫–æ–ª–æ 100 —É–¥–∞—Ä–æ–≤ –º–æ–ª–Ω–∏–π.',
    '–°–∞–º—ã–π –¥–æ–∂–¥–ª–∏–≤—ã–π –≥–æ—Ä–æ–¥ –≤ –º–∏—Ä–µ ‚Äî –ú–∞–≤—Å–∏–Ω—Ä–∞–º (–ò–Ω–¥–∏—è).',
    '–°–Ω–µ–≥ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–æ–∑–æ–≤—ã–º ‚Äî ‚Äú–∞—Ä–±—É–∑–Ω—ã–π —Å–Ω–µ–≥‚Äù.',
    '–ù–∞ –í–µ–Ω–µ—Ä–µ –∏–¥—ë—Ç ‚Äú–º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π –¥–æ–∂–¥—å‚Äù –∏–∑ —Ä–∞—Å–ø–ª–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–≤–∏–Ω—Ü–∞.'
  ];
  const list=document.getElementById('factList');
  list.innerHTML='';
  const shuffled = [...facts].sort(()=>0.5-Math.random()).slice(0,5);
  shuffled.forEach(f => list.innerHTML += `<div class='card'>${f}</div>`);
}
</script>
</body>
</html>
